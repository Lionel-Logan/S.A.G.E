# Swagger UI Testing Guide - Step by Step

## What is Swagger UI?

Swagger UI is an interactive API documentation interface. It lets you test API endpoints directly without writing code. It's automatically generated by FastAPI.

---

## ğŸ¬ Getting Started with Swagger UI

### Step 1: Start the Server

**Windows:**
```bash
cd d:\S8 Project\S.A.G.E\ml\object-detection
run.bat
```

**macOS/Linux:**
```bash
cd ml/object-detection
./run.sh
```

**Or manually:**
```bash
python -m uvicorn src.main:app --host 127.0.0.1 --port 8001
```

**Wait for this message:**
```
INFO:     Application startup complete
INFO:     Uvicorn running on http://127.0.0.1:8001
```

---

### Step 2: Open Swagger UI

Open your browser and go to:

```
http://127.0.0.1:8001/docs
```

You should see the interactive API documentation.

---

## ğŸ“‹ Swagger UI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Object Detection Service v1.0.0                             â”‚
â”‚  YOLO-based object detection service with spatial reasoning  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¼ GET  /                           [Try it out]             â”‚
â”‚  â–¼ GET  /api/v1/objects/health     [Try it out]             â”‚
â”‚  â–¼ POST /api/v1/objects/detect     [Try it out]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª Test 1: Health Check (Simple - Start Here!)

### What It Does
Checks if the YOLO model is loaded and ready.

### Steps

**1. Expand the endpoint:**
Click the dropdown arrow next to:
```
GET  /api/v1/objects/health
```

**2. Click "Try it out":**
You'll see a button that says "Try it out" on the right side. Click it.

**3. Click "Execute":**
Now you can see the blue "Execute" button. Click it.

**4. View Response:**
You'll see the response at the bottom:

```json
{
  "status": "healthy",
  "model_loaded": true,
  "model_name": "yolov8s"
}
```

**Status Code:** `200` âœ“ Success!

---

## ğŸ¯ Test 2: Object Detection (Main Test)

### What It Does
Detects objects in a Base64-encoded image and returns their positions.

### Steps

**1. Expand the endpoint:**
Click the dropdown arrow next to:
```
POST /api/v1/objects/detect
```

You'll see the request body format.

**2. Click "Try it out":**
You'll see the request body input area.

**3. Enter Request Data:**

Replace the example with this sample request:

```json
{
  "image_base64": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
  "confidence_threshold": 0.5
}
```

**4. Click "Execute":**
Click the blue "Execute" button.

**5. View Response:**
You'll see the response in the "Responses" section below.

### Sample Response

```json
{
  "status": "success",
  "inference_time_ms": 45.23,
  "detected_objects": [
    {
      "label": "person",
      "confidence": 0.95,
      "position_description": "person on the left side",
      "bounding_box": {
        "x": 10.5,
        "y": 50.2,
        "width": 80.3,
        "height": 200.1
      },
      "relative_position": {
        "horizontal": "left",
        "vertical": "middle"
      }
    },
    {
      "label": "chair",
      "confidence": 0.87,
      "position_description": "chair in the bottom-right",
      "bounding_box": {
        "x": 200.1,
        "y": 300.5,
        "width": 120.2,
        "height": 150.3
      },
      "relative_position": {
        "horizontal": "right",
        "vertical": "bottom"
      }
    }
  ],
  "total_detections": 2
}
```

---

## ğŸ“Š Understanding the Response

### Response Fields Explained

```json
{
  "status": "success",                          // âœ“ Request succeeded
  "inference_time_ms": 45.23,                  // How fast? (milliseconds)
  "detected_objects": [                         // Array of found objects
    {
      "label": "person",                       // What is it? (person, car, etc.)
      "confidence": 0.95,                      // How sure? (0.0 = 0%, 1.0 = 100%)
      "position_description": "person on the left side",  // Human readable
      "bounding_box": {                        // Where exactly?
        "x": 10.5,                            // Distance from left edge
        "y": 50.2,                            // Distance from top edge
        "width": 80.3,                        // Box width
        "height": 200.1                       // Box height
      },
      "relative_position": {                  // Simplified position
        "horizontal": "left",                 // left, center, or right
        "vertical": "middle"                  // top, middle, or bottom
      }
    }
  ],
  "total_detections": 2                       // How many objects found?
}
```

---

## ğŸ”§ Different Test Scenarios

### Test Scenario 1: Default Settings
```json
{
  "image_base64": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
  "confidence_threshold": 0.5
}
```
**Result:** Balanced detection - medium sensitivity

---

### Test Scenario 2: High Sensitivity (Lower Threshold)
```json
{
  "image_base64": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
  "confidence_threshold": 0.3
}
```
**Result:** Detects more objects, including less certain ones

---

### Test Scenario 3: High Precision (Higher Threshold)
```json
{
  "image_base64": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
  "confidence_threshold": 0.9
}
```
**Result:** Only very confident detections

---

## ğŸ–¼ï¸ Testing with Your Own Image

### Step 1: Prepare Your Image
Have an image file ready (JPG, PNG, BMP, or WebP)

### Step 2: Convert to Base64

**Using Python (easiest):**

Open Python:
```bash
python
```

Run this:
```python
import base64

with open("your_image.jpg", "rb") as f:
    image_base64 = base64.b64encode(f.read()).decode()

print(image_base64)
```

Copy the output (the long string).

### Step 3: Paste into Swagger

1. Go to the `/api/v1/objects/detect` endpoint in Swagger UI
2. Click "Try it out"
3. Replace the `image_base64` value with your copied string:

```json
{
  "image_base64": "PASTE_YOUR_LONG_STRING_HERE",
  "confidence_threshold": 0.5
}
```

4. Click "Execute"

---

## âŒ Testing Error Handling

### Test Error 1: Invalid Base64

**Request:**
```json
{
  "image_base64": "not_valid_base64!!!",
  "confidence_threshold": 0.5
}
```

**Expected Response:**
```json
{
  "detail": {
    "status": "error",
    "error_type": "InvalidBase64Exception",
    "message": "Invalid Base64 format"
  }
}
```

**Status Code:** `400` (Bad Request)

---

### Test Error 2: Empty Image

**Request:**
```json
{
  "image_base64": "",
  "confidence_threshold": 0.5
}
```

**Expected Response:**
```json
{
  "detail": {
    "status": "error",
    "error_type": "ValidationException",
    "message": "Image base64 string cannot be empty"
  }
}
```

**Status Code:** `400` (Bad Request)

---

### Test Error 3: Invalid Threshold

**Request:**
```json
{
  "image_base64": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==",
  "confidence_threshold": 1.5
}
```

**Expected Response:**
```json
{
  "detail": [
    {
      "loc": ["body", "confidence_threshold"],
      "msg": "ensure this value is less than or equal to 1",
      "type": "value_error.number.not_le"
    }
  ]
}
```

**Status Code:** `422` (Validation Error)

---

## ğŸ“ Tips & Tricks

### 1. Copy-Paste Request/Response
Swagger UI lets you easily copy the entire JSON request and response.

### 2. Clear Cache
If you see stale responses, press:
- Windows: `Ctrl+Shift+Delete`
- macOS: `Cmd+Shift+Delete`

### 3. Multiple Tests
Keep the browser tab open and run multiple tests.

### 4. Monitor Performance
Look at `inference_time_ms` to monitor detection speed:
- < 100ms = Great
- 100-200ms = Good
- > 200ms = Slow

### 5. Request History
Swagger UI remembers your last requests. Use the dropdown to quickly re-run.

---

## ğŸ¬ Full Test Flow

### Test Sequence (Recommended)

**Step 1:** Health Check
```
GET /api/v1/objects/health
```
âœ“ Verify model is loaded

**Step 2:** Simple Detection
```
POST /api/v1/objects/detect
```
âœ“ Test with sample image

**Step 3:** Your Own Image
```
POST /api/v1/objects/detect
```
âœ“ Encode and test your image

**Step 4:** Different Thresholds
```
POST /api/v1/objects/detect
```
âœ“ Try 0.3, 0.5, 0.7, 0.9

**Step 5:** Error Cases
```
POST /api/v1/objects/detect
```
âœ“ Test invalid input

---

## ğŸ“± Response Codes Quick Reference

| Code | Meaning | Example |
|------|---------|---------|
| **200** | Success | Object detected |
| **400** | Bad Request | Invalid Base64 |
| **422** | Validation Error | Invalid threshold |
| **500** | Server Error | Model failure |

---

## ğŸ› Troubleshooting in Swagger

### Issue: "Cannot reach server"

**Solution:**
1. Check if server is running in terminal
2. Check URL is: http://127.0.0.1:8001/docs
3. Try refreshing page: F5

### Issue: Model takes too long to load

**What's happening:** First run downloads model (~22.5 MB)
**Solution:** Wait 2-3 minutes, only happens once

### Issue: No objects detected

**Possible causes:**
- Image quality too low
- Objects too small
- Threshold too high

**Solution:**
- Try threshold 0.3
- Use clearer images
- Use sample image first

### Issue: Slow inference (>200ms)

**Cause:** CPU is slow, model has lots to process

**Solution:**
- That's normal for CPU inference
- GPU would be ~5x faster
- Still acceptable for single-image use case

---

## ğŸ’¡ Pro Tips

1. **Start with health check** to verify setup
2. **Use sample images first** to understand responses
3. **Monitor inference time** - should be 20-100ms
4. **Try different thresholds** to find sweet spot
5. **Use Swagger's "Try it out"** - easiest way to test

---

## ğŸ“ What You'll Learn

By testing, you'll understand:
- âœ“ How the API works
- âœ“ Response format and fields
- âœ“ How confidence affects results
- âœ“ Object position descriptions
- âœ“ Error handling
- âœ“ Performance metrics

---

## âœ… You're Ready to Test!

1. **Start server** (run.bat or run.sh)
2. **Open browser** to http://127.0.0.1:8001/docs
3. **Click Try it out** on any endpoint
4. **Execute** requests
5. **View responses**

Have fun testing! ğŸš€

---

## ğŸ”— Quick Links

- **Swagger UI:** http://127.0.0.1:8001/docs
- **Alternative Docs:** http://127.0.0.1:8001/redoc
- **API Info:** http://127.0.0.1:8001/

---

**Next: Try the Health Check endpoint first!** âœ¨
